```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  warning = F,
  message = F
)
```

```{r, include = FALSE}
library(regress3d)
library(plotly)
library(stargazer)
la_counties <- subset(county_data, state_abbrv == "LA")
model1 <- lm(prcnt_GOP16 ~ median_income16_1k,  data = la_counties)
model2 <- lm(prcnt_GOP16 ~ median_income16_1k + prcnt_black, data = la_counties)
model3 <- lm(prcnt_black ~ median_income16_1k, data = la_counties)

income_seq <-  seq(min(la_counties$median_income16_1k, na.rm=TRUE),
                   max(la_counties$median_income16_1k, na.rm=TRUE),
                   length.out=10) 
income_seq <- data.frame(median_income16_1k =income_seq)
predicted_gop <- predict(object = model1, newdata = income_seq, 
                         interval = "confidence") %>%
  as.data.frame(.)
predicted_prcnt_black <- predict(object = model3, newdata = income_seq)

simulated_data_nested_model <- data.frame(median_income16_1k = income_seq,
                                          prcnt_black = predicted_prcnt_black,
                                          prcnt_GOP16 = predicted_gop$fit,
                                          lowerCI = predicted_gop$lwr,
                                          upperCI = predicted_gop$upr)

income_edu_data <- data.frame(median_income16_1k = income_seq,
                              prcnt_black = predicted_prcnt_black)
predicted_gop <- predict(object = model2, newdata = income_edu_data, interval = "confidence") %>%
  as.data.frame(.)
simulated_data_model2 <- data.frame(median_income16_1k = income_seq,
                                    prcnt_black = predicted_prcnt_black,
                                    prcnt_GOP16 = predicted_gop$fit,
                                    lowerCI = predicted_gop$lwr,
                                    upperCI = predicted_gop$upr)

```

# Interpreting Joint Changes in $x_1$ and $x_2$ {#sec-jointdir}

For reference, the nested model is defined as Model \ref{ypredbyx1}:

\begin{align}
y =& \beta_1 x_1 + \beta_0 +\epsilon \label{ypredbyx1}\\
\text{r-shift} =& \beta_1*\text{median-income16-1k} + \beta_0 + \epsilon \nonumber.
\end{align}

The full model is defined as as Model \ref{ypredbyx1x2}:

\begin{align}
y =& \beta'_1 x_1 +\beta'_2 x_2 + \beta'_0 +\epsilon' \label{ypredbyx1x2}\\
\text{r-shift} =& \beta'_1*\text{median-income16-1k} +\beta'_2*\text{% Black} + \beta'_0 + \epsilon'. \nonumber
\end{align}

The model that defines the direction of the change in $y$ in the nested model is Model \ref{x1predbyx2}:

\begin{align}
  x_2 =& \gamma_{1} x_1 + \gamma_{0} +\epsilon_{\gamma} \label{x1predbyx2}\\
\text{% Black} =& \beta_1*\text{median-income16-1k} + \beta_0 + \epsilon. \nonumber
\end{align}

The nested model and the $\gamma_1$ direction in the full model are shown below in the regression surface generated by the full model.

```{r}
plot_ly( data = la_counties,
         x = ~median_income16_1k,
         y = ~prcnt_black,
         z = ~prcnt_GOP16) %>%
  add_markers(size = ~pop_estimate16, color = I("black"),
              name = "Louisiana counties") %>%
  add_3d_surface(model = model2)%>%
  add_direction(model = model2, direction_data = simulated_data_nested_model,
                direction_name = "Nested model:
                prcnt_GOP16 ~ median_income16_1k, omitting prcnt_black") %>%
  add_direction(model = model2, direction_data = simulated_data_model2,
                linecolor = "limegreen",
                direction_name = "The &#947;&#x0302; direction in Model 2:
                prcnt_GOP16 ~ median_income16_1k + prcnt_black")%>%
  layout(legend = list(orientation = 'h'))
```

The nested model (Model \ref{ypredbyx1}) and the $\gamma_1$ direction plotted in Model \ref{ypredbyx1x2} both reflect the change in `prcnt_GOP16` as `median_income16_1k` and `prcnt_black` jointly change. The joint change is specified by the estimated coefficient $\gamma_1$ in Model \ref{x1predbyx2}, where a one unit change in `median_income16_1k` (\$1,000) is associated with a **-0.707%** change in the percent of the county identifies as Black (`prcnt_black`).

Therefore, we can say that the nested model reflects that a joint one unit change in `median_income16_1k` (\$1,000) **and** a **-0.707%** change in `prcnt_black` predicts a 0.364 unit change in `prcnt_GOP16`.

```{r, results = 'asis'}
stargazer(model1, model2, model3, 
          # type = "text",
          type = "html",
          model.numbers = F,
          column.labels =  c("1","2","3"))
```

In general, a one unit change in $x_1$ *and* a $\gamma_1$ unit change in $x_2$ are associated with a $\beta_1$ change in $y$.





